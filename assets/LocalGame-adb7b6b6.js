import{d as E,af as j,r as p,h as w,c as K,n,ai as t,ah as s,ao as D,ad as L,o as C,b8 as G,b9 as R,ba as g,ak as z,ag as M,ae as r,bb as $,bc as N,u as q,bd as H,be as I,bf as J,bg as Q}from"./index-4d976010.js";import{u as X,W as Y,_ as Z,V as T,C as ee,a as u}from"./save-527b7b11.js";import{h}from"./VTextField-cbbf207c.js";import"./VOverlay-c8384675.js";const ae={class:"d-flex flex-column"},te={class:"d-flex flex-column"},le=g("span",{class:"Label mx-auto"},"菜单",-1),ne={class:"d-flex"},se={class:"d-flex flex-column"},oe={class:"d-flex flex-column"},fe=E({__name:"LocalGame",props:{config:null},setup(A){const F=A,B=j(),O=q(),c=X();c.LoadStorage();const d=new Y,i=new ee(0,d);d.init(F.config),d.game.start();const k=p({canUndo:!1,canRedo:!1}),y=p(d.game.getState()),m=w(()=>y.value.player[0]);d.server.notify.push(a=>{y.value=a}),d.saveStateChanged=()=>{k.value=d.getState()};function W(){O.back()}document.onkeydown=a=>{var e,l;if(!(a.shiftKey||a.altKey)){if(a.ctrlKey){switch(a.key){case"z":k.value.canUndo&&d.undo();break;case"y":k.value.canRedo&&d.redo();break}return}switch(a.key){case"w":i.autoPost({msg:"$upgrade"});break;case"z":i.autoPost({msg:"$finish"});break;case"c":i.autoPost({msg:(e=i.getPlayer())!=null&&e.locked?"$unlock":"$lock"});break;case"r":i.autoPost({msg:"$refresh"});break;default:{const o=y.value.player[i.pos];if(!o||o.selected.area==="none")break;for(const v of((l=o[o.selected.area][o.selected.place])==null?void 0:l.actions)||[])if(a.key===v.acckey){i.post(v.msg);break}}}}};const x=p(!1),V=p(""),_=w(()=>y.value.config.ActivePack.map(a=>H[a]).reduce((a,e)=>a.concat(e),[]).map(a=>I[a]).map((a,e)=>({card:a,find:a.pinyin.indexOf(V.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({card:a})=>a).slice(0,10)),S=p(!1),U=p(""),P=w(()=>J.map(a=>Q[a]).map((a,e)=>({unit:a,find:a.pinyin.indexOf(U.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({unit:a})=>a).slice(0,10));return(a,e)=>(C(),K(L,null,[n(Z,{state:y.value,client:t(i)},null,8,["state","client"]),n(T,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l)},{default:s(()=>[n(D,null,{default:s(()=>[n(G,null,{default:s(()=>[n(h,{"hide-details":"",density:t(B).isMobile?"compact":"default",modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),onKeyup:e[1]||(e[1]=R(l=>t(_).length>0&&t(i).autoPost({msg:"$cheat",type:"card",cardt:t(_)[0].name}),["enter"]))},null,8,["density","modelValue"]),g("div",ae,[(C(!0),K(L,null,z(t(_),(l,o)=>(C(),M(u,{variant:"flat",class:N({enterSelect:o===0}),key:`GCChoice-${o}`,onClick:v=>t(i).autoPost({msg:"$cheat",type:"card",cardt:l.name})},{default:s(()=>[r($(l.pinyin)+" "+$(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(T,{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=l=>S.value=l)},{default:s(()=>[n(D,null,{default:s(()=>[n(G,null,{default:s(()=>[n(h,{"hide-details":"",density:t(B).isMobile?"compact":"default",modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=l=>U.value=l),onKeyup:e[4]||(e[4]=R(l=>{var o;return t(P).length>0&&t(i).autoPost({msg:"$cheat",type:"unit",units:[t(P)[0].name],place:((o=t(m))==null?void 0:o.selected.place)||0})},["enter"]))},null,8,["density","modelValue"]),g("div",te,[(C(!0),K(L,null,z(t(P),(l,o)=>(C(),M(u,{variant:"flat",class:N({enterSelect:o===0}),key:`GUChoice-${o}`,onClick:v=>{var b;return t(i).autoPost({msg:"$cheat",type:"unit",units:[l.name],place:((b=t(m))==null?void 0:b.selected.place)||0})}},{default:s(()=>[r($(l.pinyin)+" "+$(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(D,{class:"Debug d-flex flex-column"},{default:s(()=>{var l,o,v,b;return[le,g("div",ne,[g("div",se,[n(u,{variant:"elevated",onClick:e[6]||(e[6]=f=>W())},{default:s(()=>[r(" 返回 ")]),_:1}),n(u,{variant:"elevated",onClick:e[7]||(e[7]=f=>x.value=!0),disabled:((l=t(m))==null?void 0:l.status)!=="normal"},{default:s(()=>[r(" 卡牌 ")]),_:1},8,["disabled"]),n(u,{variant:"elevated",disabled:((o=t(m))==null?void 0:o.selected.area)!=="present"||((v=t(m))==null?void 0:v.status)!=="normal",onClick:e[8]||(e[8]=f=>S.value=!0)},{default:s(()=>[r(" 单位 ")]),_:1},8,["disabled"]),n(u,{variant:"elevated",disabled:((b=t(m))==null?void 0:b.status)!=="normal",onClick:e[9]||(e[9]=f=>t(i).autoPost({msg:"$cheat",type:"resource"}))},{default:s(()=>[r(" 资源 ")]),_:1},8,["disabled"])]),g("div",oe,[n(u,{variant:"elevated",disabled:!k.value.canUndo,onClick:e[10]||(e[10]=f=>t(d).undo())},{default:s(()=>[r(" 撤销 ")]),_:1},8,["disabled"]),n(u,{variant:"elevated",disabled:!k.value.canRedo,onClick:e[11]||(e[11]=f=>t(d).redo())},{default:s(()=>[r(" 重做 ")]),_:1},8,["disabled"]),n(u,{variant:"elevated",onClick:e[12]||(e[12]=f=>t(c).SaveStorage(t(d).save))},{default:s(()=>[r(" 保存 ")]),_:1}),n(u,{variant:"elevated",disabled:!t(c).save,onClick:e[13]||(e[13]=f=>t(c).save?t(d).load(t(c).save):void 0)},{default:s(()=>[r(" 读取 ")]),_:1},8,["disabled"]),n(u,{variant:"elevated",disabled:!t(c).save,onClick:e[14]||(e[14]=f=>t(c).CleanStorage())},{default:s(()=>[r(" 清除 ")]),_:1},8,["disabled"])])])]}),_:1})],64))}});export{fe as default};
