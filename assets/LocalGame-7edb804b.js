import{a as ie,q as re,J as de,u as fe,c as C,aE as O,r as v,f as ce,j as ve,h as t,l as E,K as I,aD as J,s as me,M as pe,N as ge,T as L,P as s,R as n,Q as R,U as h,L as d,aF as D,aG as q,W as Q,O as X,aH as Y,a0 as ke,aI as Ce,aJ as ye,aK as Ve}from"./index-45082477.js";import{u as $e,W as be,_ as Se,V as M,C as Pe,a as f}from"./save-be701f57.js";import{B as xe,D as j,W as G,X as we,F as Ie,E as Ue}from"./VOverlay-13b8fe6e.js";import{m as Fe,i as Be,f as ze,j as Re,k as De,g as Ke,l as Ae,a as _e,h as Z}from"./VChip-0fb193f5.js";const he=ie({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,hint:String,persistentHint:Boolean,placeholder:String,showSize:{type:[Boolean,Number],default:!1,validator:o=>typeof o=="boolean"||[1e3,1024].includes(o)},...Fe({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:o=>re(o).every(b=>b!=null&&typeof b=="object")},...Be({clearable:!0})},emits:{"click:control":o=>!0,"update:modelValue":o=>!0},setup(o,b){let{attrs:S,emit:N,slots:i}=b;const{t:r}=de(),u=fe(o,"modelValue"),y=C(()=>typeof o.showSize!="boolean"?o.showSize:void 0),g=C(()=>(u.value??[]).reduce((e,l)=>{let{size:m=0}=l;return e+m},0)),k=C(()=>O(g.value,y.value)),U=C(()=>(u.value??[]).map(e=>{const{name:l="",size:m=0}=e;return o.showSize?`${l} (${O(m,y.value)})`:l})),F=C(()=>{var e;const l=((e=u.value)==null?void 0:e.length)??0;return o.showSize?r(o.counterSizeString,l,k.value):r(o.counterString,l)}),P=v(),x=v(),p=v(!1),c=v(),B=C(()=>o.messages.length?o.messages:o.persistentHint?o.hint:"");function V(){if(c.value!==document.activeElement){var e;(e=c.value)==null||e.focus()}p.value||(p.value=!0)}function w(e){J(o["onClick:prepend"],e),K(e)}function K(e){var l;(l=c.value)==null||l.click(),N("click:control",e)}function a(e){e.stopPropagation(),V(),me(()=>{u.value=[],c!=null&&c.value&&(c.value.value=""),J(o["onClick:clear"],e)})}return ce(()=>{const e=!!(i.counter||o.counter),l=!!(e||i.details),[m,T]=ve(S),[{modelValue:Me,...ee}]=ze(o),[le]=Re(o);return t(_e,E({ref:P,modelValue:u.value,"onUpdate:modelValue":z=>u.value=z,class:"v-file-input","onClick:prepend":w,"onClick:append":o["onClick:append"]},m,ee,{focused:p.value,messages:B.value}),{...i,default:z=>{let{id:A,isDisabled:_,isDirty:W,isReadonly:ae,isValid:te}=z;return t(De,E({ref:x,"prepend-icon":o.prependIcon,"onClick:control":K,"onClick:clear":a,"onClick:prependInner":o["onClick:prependInner"],"onClick:appendInner":o["onClick:appendInner"]},le,{id:A.value,active:W.value||p.value,dirty:W.value,focused:p.value,error:te.value===!1}),{...i,default:ne=>{var H;let{props:{class:oe,...se}}=ne;return t(I,null,[t("input",E({ref:c,type:"file",readonly:ae.value,disabled:_.value,multiple:o.multiple,name:o.name,onClick:$=>{$.stopPropagation(),V()},onChange:$=>{if(!$.target)return;const ue=$.target;u.value=[...ue.files??[]]},onFocus:V,onBlur:()=>p.value=!1},se,T),null),t("div",{class:oe},[!!((H=u.value)!=null&&H.length)&&(i.selection?i.selection({fileNames:U.value,totalBytes:g.value,totalBytesReadable:k.value}):o.chips?U.value.map($=>t(Ke,{key:$,size:"small",color:o.color},{default:()=>[$]})):U.value.join(", "))])])}})},details:l?z=>{var A,_;return t(I,null,[(A=i.details)==null?void 0:A.call(i,z),e&&t(I,null,[t("span",null,null),t(Ae,{active:!!((_=u.value)!=null&&_.length),value:F.value},i.counter)])])}:void 0})}),xe({},P,x,c)}}),Ne={class:"d-flex flex-column"},Te={class:"d-flex flex-column"},Ee={class:"d-flex flex-column"},Le={class:"d-flex flex-column"},Oe=pe({__name:"LocalGame",props:{config:null},setup(o){const b=o,S=ge(),N=ke(),i=$e();i.LoadStorage();const r=new be,u=new Pe(0,r);r.init(b.config),r.game.start();const y=v({canUndo:!1,canRedo:!1}),g=v(r.game.getState()),k=C(()=>g.value.player[0]);r.server.notify.push(a=>{g.value=a}),r.saveStateChanged=()=>{y.value=r.getState()};function U(){N.back()}document.onkeydown=a=>{if(!(a.shiftKey||a.altKey)){if(a.ctrlKey){switch(a.key){case"z":y.value.canUndo&&r.undo();break;case"y":y.value.canRedo&&r.redo();break}return}switch(a.key){case"w":u.autoPost({msg:"$upgrade"});break;case"z":u.autoPost({msg:"$finish"});break;case"c":u.autoPost({msg:u.getPlayer()?.locked?"$unlock":"$lock"});break;case"r":u.autoPost({msg:"$refresh"});break;default:{const e=g.value.player[u.pos];if(!e||e.selected.area==="none")break;for(const l of e[e.selected.area][e.selected.place]?.actions||[])if(a.key===l.acckey){u.post(l.msg);break}}}}};const F=v(!1),P=v(""),x=C(()=>g.value.config.ActivePack.map(a=>Ce[a]).reduce((a,e)=>a.concat(e),[]).map(a=>ye[a]).map((a,e)=>({card:a,find:a.pinyin.indexOf(P.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({card:a})=>a).slice(0,10)),p=v(!1),c=v(""),B=C(()=>g.value.config.ActiveUnit.map(a=>Ve[a]).map((a,e)=>({unit:a,find:a.pinyin.indexOf(c.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({unit:a})=>a).slice(0,10)),V=v(!1),w=v([]);function K(){i.Upload(w.value[0]),V.value=!1}return(a,e)=>(R(),L(I,null,[t(Se,{class:"MiddleScale",state:g.value,client:n(u)},{default:s(()=>[h("div",Ne,[t(f,{variant:"flat",onClick:e[0]||(e[0]=l=>U())},{default:s(()=>[d(" 返回 ")]),_:1}),t(f,{variant:"flat",onClick:e[1]||(e[1]=l=>F.value=!0),disabled:n(k)?.status!=="normal"},{default:s(()=>[d(" 卡牌 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:n(k)?.selected.area!=="present"||n(k)?.status!=="normal",onClick:e[2]||(e[2]=l=>p.value=!0)},{default:s(()=>[d(" 单位 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:n(k)?.status!=="normal",onClick:e[3]||(e[3]=l=>n(u).autoPost({msg:"$cheat",type:"resource"}))},{default:s(()=>[d(" 资源 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",class:"mt-auto",onClick:e[4]||(e[4]=l=>n(S).toggleFullScreen())},{default:s(()=>[d(D(n(S).isFullScreen?"窗口":"全屏"),1)]),_:1})]),h("div",Te,[t(f,{variant:"flat",disabled:!y.value.canUndo,onClick:e[5]||(e[5]=l=>n(r).undo())},{default:s(()=>[d(" 撤销 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:!y.value.canRedo,onClick:e[6]||(e[6]=l=>n(r).redo())},{default:s(()=>[d(" 重做 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",onClick:e[7]||(e[7]=l=>n(i).SaveStorage(n(r).save))},{default:s(()=>[d(" 保存 ")]),_:1}),t(f,{variant:"flat",disabled:!n(i).save,onClick:e[8]||(e[8]=l=>n(i).save?n(r).load(n(i).save):void 0)},{default:s(()=>[d(" 读取 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:!n(i).save,onClick:e[9]||(e[9]=l=>n(i).CleanStorage())},{default:s(()=>[d(" 清除 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:!n(i).save,onClick:e[10]||(e[10]=l=>n(i).Download())},{default:s(()=>[d(" 导出 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",onClick:e[11]||(e[11]=l=>V.value=!0)},{default:s(()=>[d(" 导入 ")]),_:1})])]),_:1},8,["state","client"]),t(M,{modelValue:F.value,"onUpdate:modelValue":e[14]||(e[14]=l=>F.value=l)},{default:s(()=>[t(j,null,{default:s(()=>[t(G,null,{default:s(()=>[t(Z,{"hide-details":"",density:n(S).isMobile?"compact":"default",modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=l=>P.value=l),onKeyup:e[13]||(e[13]=q(l=>n(x).length>0&&n(u).autoPost({msg:"$cheat",type:"card",cardt:n(x)[0].name}),["enter"]))},null,8,["density","modelValue"]),h("div",Ee,[(R(!0),L(I,null,Q(n(x),(l,m)=>(R(),X(f,{variant:"flat",class:Y({enterSelect:m===0}),key:`GCChoice-${m}`,onClick:T=>n(u).autoPost({msg:"$cheat",type:"card",cardt:l.name})},{default:s(()=>[d(D(l.pinyin)+" "+D(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:p.value,"onUpdate:modelValue":e[17]||(e[17]=l=>p.value=l)},{default:s(()=>[t(j,null,{default:s(()=>[t(G,null,{default:s(()=>[t(Z,{"hide-details":"",density:n(S).isMobile?"compact":"default",modelValue:c.value,"onUpdate:modelValue":e[15]||(e[15]=l=>c.value=l),onKeyup:e[16]||(e[16]=q(l=>n(B).length>0&&n(u).autoPost({msg:"$cheat",type:"unit",units:[n(B)[0].name],place:n(k)?.selected.place||0}),["enter"]))},null,8,["density","modelValue"]),h("div",Le,[(R(!0),L(I,null,Q(n(B),(l,m)=>(R(),X(f,{variant:"flat",class:Y({enterSelect:m===0}),key:`GUChoice-${m}`,onClick:T=>n(u).autoPost({msg:"$cheat",type:"unit",units:[l.name],place:n(k)?.selected.place||0})},{default:s(()=>[d(D(l.pinyin)+" "+D(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:V.value,"onUpdate:modelValue":e[20]||(e[20]=l=>V.value=l)},{default:s(()=>[t(j,null,{default:s(()=>[t(we,null,{default:s(()=>[d(" 导入 ")]),_:1}),t(G,null,{default:s(()=>[t(he,{modelValue:w.value,"onUpdate:modelValue":e[18]||(e[18]=l=>w.value=l),accept:".SCTReplay"},null,8,["modelValue"])]),_:1}),t(Ie,null,{default:s(()=>[t(Ue,{color:"primary",disabled:w.value.length!==1,onClick:e[19]||(e[19]=l=>K())},{default:s(()=>[d(" 确定 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{Oe as default};
