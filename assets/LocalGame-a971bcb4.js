import{e as de,A as re,aa as ce,f as fe,h as C,b8 as J,r as p,l as ve,s as me,n as t,x as j,ab as z,aG as Q,C as pe,d as ge,ad as ke,c as E,ag as s,af as o,am as T,o as D,b9 as H,ba as X,bb as w,ai as Y,ae as Z,ac as c,bc as G,bd as ee,be as ye,al as Ce,u as be,bf as Ve,bg as $e,bh as Se,bi as xe}from"./index-ae630794.js";import{u as Pe,W as _e,_ as Ie,V as O,C as Ue,a as f}from"./save-9dc7d76b.js";import{m as we,i as ze,f as Be,j as Fe,k as Re,g as he,l as De,a as Ae,h as le}from"./VChip-abed16fb.js";import{c as Ke,d as Le}from"./VOverlay-fa0bf222.js";const Ne=de({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,hint:String,persistentHint:Boolean,placeholder:String,showSize:{type:[Boolean,Number],default:!1,validator:n=>typeof n=="boolean"||[1e3,1024].includes(n)},...we({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:n=>re(n).every(x=>x!=null&&typeof x=="object")},...ze({clearable:!0})},emits:{"click:control":n=>!0,"update:modelValue":n=>!0},setup(n,x){let{attrs:A,emit:M,slots:d}=x;const{t:r}=ce(),u=fe(n,"modelValue"),b=C(()=>typeof n.showSize!="boolean"?n.showSize:void 0),V=C(()=>(u.value??[]).reduce((e,a)=>{let{size:i=0}=a;return e+i},0)),k=C(()=>J(V.value,b.value)),B=C(()=>(u.value??[]).map(e=>{const{name:a="",size:i=0}=e;return n.showSize?`${a} (${J(i,b.value)})`:a})),F=C(()=>{var e;const a=((e=u.value)==null?void 0:e.length)??0;return n.showSize?r(n.counterSizeString,a,k.value):r(n.counterString,a)}),P=p(),_=p(),g=p(!1),v=p(),R=C(()=>n.messages.length?n.messages:n.persistentHint?n.hint:"");function $(){if(v.value!==document.activeElement){var e;(e=v.value)==null||e.focus()}g.value||(g.value=!0)}function I(e){Q(n["onClick:prepend"],e),K(e)}function K(e){var a;(a=v.value)==null||a.click(),M("click:control",e)}function l(e){e.stopPropagation(),$(),pe(()=>{u.value=[],v!=null&&v.value&&(v.value.value=""),Q(n["onClick:clear"],e)})}return ve(()=>{const e=!!(d.counter||n.counter),a=!!(e||d.details),[i,y]=me(A),[{modelValue:U,...m}]=Be(n),[ae]=Fe(n);return t(Ae,j({ref:P,modelValue:u.value,"onUpdate:modelValue":h=>u.value=h,class:"v-file-input","onClick:prepend":I,"onClick:append":n["onClick:append"]},i,m,{focused:g.value,messages:R.value}),{...d,default:h=>{let{id:L,isDisabled:N,isDirty:W,isReadonly:te,isValid:ne}=h;return t(Re,j({ref:_,"prepend-icon":n.prependIcon,"onClick:control":K,"onClick:clear":l,"onClick:prependInner":n["onClick:prependInner"],"onClick:appendInner":n["onClick:appendInner"]},ae,{id:L.value,active:W.value||g.value,dirty:W.value,focused:g.value,error:ne.value===!1}),{...d,default:se=>{var q;let{props:{class:oe,...ue}}=se;return t(z,null,[t("input",j({ref:v,type:"file",readonly:te.value,disabled:N.value,multiple:n.multiple,name:n.name,onClick:S=>{S.stopPropagation(),$()},onChange:S=>{if(!S.target)return;const ie=S.target;u.value=[...ie.files??[]]},onFocus:$,onBlur:()=>g.value=!1},ue,y),null),t("div",{class:oe},[!!((q=u.value)!=null&&q.length)&&(d.selection?d.selection({fileNames:B.value,totalBytes:V.value,totalBytesReadable:k.value}):n.chips?B.value.map(S=>t(he,{key:S,size:"small",color:n.color},{default:()=>[S]})):B.value.join(", "))])])}})},details:a?h=>{var L,N;return t(z,null,[(L=d.details)==null?void 0:L.call(d,h),e&&t(z,null,[t("span",null,null),t(De,{active:!!((N=u.value)!=null&&N.length),value:F.value},d.counter)])])}:void 0})}),Ke({},P,_,v)}}),Te={class:"d-flex flex-column"},Ge={class:"d-flex flex-column"},Me=w("span",{class:"Label mx-auto"},"菜单",-1),je={class:"d-flex"},Ee={class:"d-flex flex-column"},He={class:"d-flex flex-column"},Qe=ge({__name:"LocalGame",props:{config:null},setup(n){const x=n,A=ke(),M=be(),d=Pe();d.LoadStorage();const r=new _e,u=new Ue(0,r);r.init(x.config),r.game.start();const b=p({canUndo:!1,canRedo:!1}),V=p(r.game.getState()),k=C(()=>V.value.player[0]);r.server.notify.push(l=>{V.value=l}),r.saveStateChanged=()=>{b.value=r.getState()};function B(){M.back()}document.onkeydown=l=>{var e,a;if(!(l.shiftKey||l.altKey)){if(l.ctrlKey){switch(l.key){case"z":b.value.canUndo&&r.undo();break;case"y":b.value.canRedo&&r.redo();break}return}switch(l.key){case"w":u.autoPost({msg:"$upgrade"});break;case"z":u.autoPost({msg:"$finish"});break;case"c":u.autoPost({msg:(e=u.getPlayer())!=null&&e.locked?"$unlock":"$lock"});break;case"r":u.autoPost({msg:"$refresh"});break;default:{const i=V.value.player[u.pos];if(!i||i.selected.area==="none")break;for(const y of((a=i[i.selected.area][i.selected.place])==null?void 0:a.actions)||[])if(l.key===y.acckey){u.post(y.msg);break}}}}};const F=p(!1),P=p(""),_=C(()=>V.value.config.ActivePack.map(l=>Ve[l]).reduce((l,e)=>l.concat(e),[]).map(l=>$e[l]).map((l,e)=>({card:l,find:l.pinyin.indexOf(P.value),index:e})).filter(({find:l})=>l!==-1).sort((l,e)=>l.find!==e.find?l.find-e.find:l.index-e.index).map(({card:l})=>l).slice(0,10)),g=p(!1),v=p(""),R=C(()=>Se.map(l=>xe[l]).map((l,e)=>({unit:l,find:l.pinyin.indexOf(v.value),index:e})).filter(({find:l})=>l!==-1).sort((l,e)=>l.find!==e.find?l.find-e.find:l.index-e.index).map(({unit:l})=>l).slice(0,10)),$=p(!1),I=p([]);function K(){d.Upload(I.value[0]),$.value=!1}return(l,e)=>(D(),E(z,null,[t(Ie,{state:V.value,client:s(u)},null,8,["state","client"]),t(O,{modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=a=>F.value=a)},{default:o(()=>[t(T,null,{default:o(()=>[t(H,null,{default:o(()=>[t(le,{"hide-details":"",density:s(A).isMobile?"compact":"default",modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=a=>P.value=a),onKeyup:e[1]||(e[1]=X(a=>s(_).length>0&&s(u).autoPost({msg:"$cheat",type:"card",cardt:s(_)[0].name}),["enter"]))},null,8,["density","modelValue"]),w("div",Te,[(D(!0),E(z,null,Y(s(_),(a,i)=>(D(),Z(f,{variant:"flat",class:ee({enterSelect:i===0}),key:`GCChoice-${i}`,onClick:y=>s(u).autoPost({msg:"$cheat",type:"card",cardt:a.name})},{default:o(()=>[c(G(a.pinyin)+" "+G(a.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a)},{default:o(()=>[t(T,null,{default:o(()=>[t(H,null,{default:o(()=>[t(le,{"hide-details":"",density:s(A).isMobile?"compact":"default",modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=a=>v.value=a),onKeyup:e[4]||(e[4]=X(a=>{var i;return s(R).length>0&&s(u).autoPost({msg:"$cheat",type:"unit",units:[s(R)[0].name],place:((i=s(k))==null?void 0:i.selected.place)||0})},["enter"]))},null,8,["density","modelValue"]),w("div",Ge,[(D(!0),E(z,null,Y(s(R),(a,i)=>(D(),Z(f,{variant:"flat",class:ee({enterSelect:i===0}),key:`GUChoice-${i}`,onClick:y=>{var U;return s(u).autoPost({msg:"$cheat",type:"unit",units:[a.name],place:((U=s(k))==null?void 0:U.selected.place)||0})}},{default:o(()=>[c(G(a.pinyin)+" "+G(a.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:$.value,"onUpdate:modelValue":e[8]||(e[8]=a=>$.value=a)},{default:o(()=>[t(T,null,{default:o(()=>[t(ye,null,{default:o(()=>[c(" 导入 ")]),_:1}),t(H,null,{default:o(()=>[t(Ne,{modelValue:I.value,"onUpdate:modelValue":e[6]||(e[6]=a=>I.value=a),accept:".SCTReplay"},null,8,["modelValue"])]),_:1}),t(Ce,null,{default:o(()=>[t(Le,{color:"primary",disabled:I.value.length!==1,onClick:e[7]||(e[7]=a=>K())},{default:o(()=>[c(" 确定 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(T,{class:"Debug d-flex flex-column"},{default:o(()=>{var a,i,y,U;return[Me,w("div",je,[w("div",Ee,[t(f,{variant:"elevated",onClick:e[9]||(e[9]=m=>B())},{default:o(()=>[c(" 返回 ")]),_:1}),t(f,{variant:"elevated",onClick:e[10]||(e[10]=m=>F.value=!0),disabled:((a=s(k))==null?void 0:a.status)!=="normal"},{default:o(()=>[c(" 卡牌 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:((i=s(k))==null?void 0:i.selected.area)!=="present"||((y=s(k))==null?void 0:y.status)!=="normal",onClick:e[11]||(e[11]=m=>g.value=!0)},{default:o(()=>[c(" 单位 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:((U=s(k))==null?void 0:U.status)!=="normal",onClick:e[12]||(e[12]=m=>s(u).autoPost({msg:"$cheat",type:"resource"}))},{default:o(()=>[c(" 资源 ")]),_:1},8,["disabled"])]),w("div",He,[t(f,{variant:"elevated",disabled:!b.value.canUndo,onClick:e[13]||(e[13]=m=>s(r).undo())},{default:o(()=>[c(" 撤销 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:!b.value.canRedo,onClick:e[14]||(e[14]=m=>s(r).redo())},{default:o(()=>[c(" 重做 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",onClick:e[15]||(e[15]=m=>s(d).SaveStorage(s(r).save))},{default:o(()=>[c(" 保存 ")]),_:1}),t(f,{variant:"elevated",disabled:!s(d).save,onClick:e[16]||(e[16]=m=>s(d).save?s(r).load(s(d).save):void 0)},{default:o(()=>[c(" 读取 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:!s(d).save,onClick:e[17]||(e[17]=m=>s(d).CleanStorage())},{default:o(()=>[c(" 清除 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:!s(d).save,onClick:e[18]||(e[18]=m=>s(d).Download())},{default:o(()=>[c(" 导出 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",onClick:e[19]||(e[19]=m=>$.value=!0)},{default:o(()=>[c(" 导入 ")]),_:1})])])]}),_:1})],64))}});export{Qe as default};
