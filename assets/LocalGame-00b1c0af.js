import{b as de,v as re,a6 as ce,u as fe,c as C,b8 as J,r as v,h as ve,k as me,i as t,n as M,a7 as z,aG as Q,y as pe,a9 as ge,aa as ke,af as j,ad as s,ae as o,ab as D,b9 as T,a8 as c,al as E,ba as H,bb as X,ah as Y,ac as Z,bc as G,bd as ee,be as ye,ak as Ce,ap as be,bf as Ve,bg as $e,bh as Se,bi as Pe}from"./index-995e2b45.js";import{u as xe,W as Ie,_ as Ue,V as O,C as we,a as f}from"./save-9ee94789.js";import{m as ze,i as Be,f as Fe,j as Re,k as he,g as De,l as _e,a as Ae,h as ae}from"./VChip-6100b6bc.js";import{c as Ke,d as Ne}from"./VOverlay-c221db22.js";const Te=de({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,hint:String,persistentHint:Boolean,placeholder:String,showSize:{type:[Boolean,Number],default:!1,validator:n=>typeof n=="boolean"||[1e3,1024].includes(n)},...ze({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:n=>re(n).every(P=>P!=null&&typeof P=="object")},...Be({clearable:!0})},emits:{"click:control":n=>!0,"update:modelValue":n=>!0},setup(n,P){let{attrs:_,emit:L,slots:d}=P;const{t:r}=ce(),u=fe(n,"modelValue"),b=C(()=>typeof n.showSize!="boolean"?n.showSize:void 0),V=C(()=>(u.value??[]).reduce((e,l)=>{let{size:i=0}=l;return e+i},0)),k=C(()=>J(V.value,b.value)),B=C(()=>(u.value??[]).map(e=>{const{name:l="",size:i=0}=e;return n.showSize?`${l} (${J(i,b.value)})`:l})),F=C(()=>{var e;const l=((e=u.value)==null?void 0:e.length)??0;return n.showSize?r(n.counterSizeString,l,k.value):r(n.counterString,l)}),x=v(),I=v(),g=v(!1),m=v(),R=C(()=>n.messages.length?n.messages:n.persistentHint?n.hint:"");function $(){if(m.value!==document.activeElement){var e;(e=m.value)==null||e.focus()}g.value||(g.value=!0)}function U(e){Q(n["onClick:prepend"],e),A(e)}function A(e){var l;(l=m.value)==null||l.click(),L("click:control",e)}function a(e){e.stopPropagation(),$(),pe(()=>{u.value=[],m!=null&&m.value&&(m.value.value=""),Q(n["onClick:clear"],e)})}return ve(()=>{const e=!!(d.counter||n.counter),l=!!(e||d.details),[i,y]=me(_),[{modelValue:w,...p}]=Fe(n),[le]=Re(n);return t(Ae,M({ref:x,modelValue:u.value,"onUpdate:modelValue":h=>u.value=h,class:"v-file-input","onClick:prepend":U,"onClick:append":n["onClick:append"]},i,p,{focused:g.value,messages:R.value}),{...d,default:h=>{let{id:K,isDisabled:N,isDirty:W,isReadonly:te,isValid:ne}=h;return t(he,M({ref:I,"prepend-icon":n.prependIcon,"onClick:control":A,"onClick:clear":a,"onClick:prependInner":n["onClick:prependInner"],"onClick:appendInner":n["onClick:appendInner"]},le,{id:K.value,active:W.value||g.value,dirty:W.value,focused:g.value,error:ne.value===!1}),{...d,default:oe=>{var q;let{props:{class:se,...ue}}=oe;return t(z,null,[t("input",M({ref:m,type:"file",readonly:te.value,disabled:N.value,multiple:n.multiple,name:n.name,onClick:S=>{S.stopPropagation(),$()},onChange:S=>{if(!S.target)return;const ie=S.target;u.value=[...ie.files??[]]},onFocus:$,onBlur:()=>g.value=!1},ue,y),null),t("div",{class:se},[!!((q=u.value)!=null&&q.length)&&(d.selection?d.selection({fileNames:B.value,totalBytes:V.value,totalBytesReadable:k.value}):n.chips?B.value.map(S=>t(De,{key:S,size:"small",color:n.color},{default:()=>[S]})):B.value.join(", "))])])}})},details:l?h=>{var K,N;return t(z,null,[(K=d.details)==null?void 0:K.call(d,h),e&&t(z,null,[t("span",null,null),t(_e,{active:!!((N=u.value)!=null&&N.length),value:F.value},d.counter)])])}:void 0})}),Ke({},x,I,m)}}),Ge={class:"d-flex flex-column"},Le={class:"d-flex flex-column"},Me={class:"d-flex flex-column"},je={class:"d-flex flex-column"},qe=ge({__name:"LocalGame",props:{config:null},setup(n){const P=n,_=ke(),L=be(),d=xe();d.LoadStorage();const r=new Ie,u=new we(0,r);r.init(P.config),r.game.start();const b=v({canUndo:!1,canRedo:!1}),V=v(r.game.getState()),k=C(()=>V.value.player[0]);r.server.notify.push(a=>{V.value=a}),r.saveStateChanged=()=>{b.value=r.getState()};function B(){L.back()}document.onkeydown=a=>{var e,l;if(!(a.shiftKey||a.altKey)){if(a.ctrlKey){switch(a.key){case"z":b.value.canUndo&&r.undo();break;case"y":b.value.canRedo&&r.redo();break}return}switch(a.key){case"w":u.autoPost({msg:"$upgrade"});break;case"z":u.autoPost({msg:"$finish"});break;case"c":u.autoPost({msg:(e=u.getPlayer())!=null&&e.locked?"$unlock":"$lock"});break;case"r":u.autoPost({msg:"$refresh"});break;default:{const i=V.value.player[u.pos];if(!i||i.selected.area==="none")break;for(const y of((l=i[i.selected.area][i.selected.place])==null?void 0:l.actions)||[])if(a.key===y.acckey){u.post(y.msg);break}}}}};const F=v(!1),x=v(""),I=C(()=>V.value.config.ActivePack.map(a=>Ve[a]).reduce((a,e)=>a.concat(e),[]).map(a=>$e[a]).map((a,e)=>({card:a,find:a.pinyin.indexOf(x.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({card:a})=>a).slice(0,10)),g=v(!1),m=v(""),R=C(()=>Se.map(a=>Pe[a]).map((a,e)=>({unit:a,find:a.pinyin.indexOf(m.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({unit:a})=>a).slice(0,10)),$=v(!1),U=v([]);function A(){d.Upload(U.value[0]),$.value=!1}return v(!0),(a,e)=>(D(),j(z,null,[t(Ue,{state:V.value,client:o(u)},{default:s(()=>{var l,i,y,w;return[T("div",Ge,[t(f,{variant:"elevated",onClick:e[0]||(e[0]=p=>B())},{default:s(()=>[c(" 返回 ")]),_:1}),t(f,{variant:"elevated",onClick:e[1]||(e[1]=p=>F.value=!0),disabled:((l=o(k))==null?void 0:l.status)!=="normal"},{default:s(()=>[c(" 卡牌 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:((i=o(k))==null?void 0:i.selected.area)!=="present"||((y=o(k))==null?void 0:y.status)!=="normal",onClick:e[2]||(e[2]=p=>g.value=!0)},{default:s(()=>[c(" 单位 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:((w=o(k))==null?void 0:w.status)!=="normal",onClick:e[3]||(e[3]=p=>o(u).autoPost({msg:"$cheat",type:"resource"}))},{default:s(()=>[c(" 资源 ")]),_:1},8,["disabled"])]),T("div",Le,[t(f,{variant:"elevated",disabled:!b.value.canUndo,onClick:e[4]||(e[4]=p=>o(r).undo())},{default:s(()=>[c(" 撤销 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:!b.value.canRedo,onClick:e[5]||(e[5]=p=>o(r).redo())},{default:s(()=>[c(" 重做 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",onClick:e[6]||(e[6]=p=>o(d).SaveStorage(o(r).save))},{default:s(()=>[c(" 保存 ")]),_:1}),t(f,{variant:"elevated",disabled:!o(d).save,onClick:e[7]||(e[7]=p=>o(d).save?o(r).load(o(d).save):void 0)},{default:s(()=>[c(" 读取 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:!o(d).save,onClick:e[8]||(e[8]=p=>o(d).CleanStorage())},{default:s(()=>[c(" 清除 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",disabled:!o(d).save,onClick:e[9]||(e[9]=p=>o(d).Download())},{default:s(()=>[c(" 导出 ")]),_:1},8,["disabled"]),t(f,{variant:"elevated",onClick:e[10]||(e[10]=p=>$.value=!0)},{default:s(()=>[c(" 导入 ")]),_:1})])]}),_:1},8,["state","client"]),t(O,{modelValue:F.value,"onUpdate:modelValue":e[13]||(e[13]=l=>F.value=l)},{default:s(()=>[t(E,null,{default:s(()=>[t(H,null,{default:s(()=>[t(ae,{"hide-details":"",density:o(_).isMobile?"compact":"default",modelValue:x.value,"onUpdate:modelValue":e[11]||(e[11]=l=>x.value=l),onKeyup:e[12]||(e[12]=X(l=>o(I).length>0&&o(u).autoPost({msg:"$cheat",type:"card",cardt:o(I)[0].name}),["enter"]))},null,8,["density","modelValue"]),T("div",Me,[(D(!0),j(z,null,Y(o(I),(l,i)=>(D(),Z(f,{variant:"flat",class:ee({enterSelect:i===0}),key:`GCChoice-${i}`,onClick:y=>o(u).autoPost({msg:"$cheat",type:"card",cardt:l.name})},{default:s(()=>[c(G(l.pinyin)+" "+G(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:g.value,"onUpdate:modelValue":e[16]||(e[16]=l=>g.value=l)},{default:s(()=>[t(E,null,{default:s(()=>[t(H,null,{default:s(()=>[t(ae,{"hide-details":"",density:o(_).isMobile?"compact":"default",modelValue:m.value,"onUpdate:modelValue":e[14]||(e[14]=l=>m.value=l),onKeyup:e[15]||(e[15]=X(l=>{var i;return o(R).length>0&&o(u).autoPost({msg:"$cheat",type:"unit",units:[o(R)[0].name],place:((i=o(k))==null?void 0:i.selected.place)||0})},["enter"]))},null,8,["density","modelValue"]),T("div",je,[(D(!0),j(z,null,Y(o(R),(l,i)=>(D(),Z(f,{variant:"flat",class:ee({enterSelect:i===0}),key:`GUChoice-${i}`,onClick:y=>{var w;return o(u).autoPost({msg:"$cheat",type:"unit",units:[l.name],place:((w=o(k))==null?void 0:w.selected.place)||0})}},{default:s(()=>[c(G(l.pinyin)+" "+G(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:$.value,"onUpdate:modelValue":e[19]||(e[19]=l=>$.value=l)},{default:s(()=>[t(E,null,{default:s(()=>[t(ye,null,{default:s(()=>[c(" 导入 ")]),_:1}),t(H,null,{default:s(()=>[t(Te,{modelValue:U.value,"onUpdate:modelValue":e[17]||(e[17]=l=>U.value=l),accept:".SCTReplay"},null,8,["modelValue"])]),_:1}),t(Ce,null,{default:s(()=>[t(Ne,{color:"primary",disabled:U.value.length!==1,onClick:e[18]||(e[18]=l=>A())},{default:s(()=>[c(" 确定 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{qe as default};
