import{a as ie,q as re,J as de,u as fe,c as k,aC as O,r as v,f as ce,j as ve,h as t,l as E,K as I,aB as J,s as me,M as pe,N as ge,T as L,P as o,R as n,Q as R,U as h,L as d,aD as D,aE as q,W as Q,O as X,aF as Y,a0 as ke,aG as Ce,aH as ye,aI as Ve,aJ as $e}from"./index-699c3828.js";import{u as be,W as Se,_ as Pe,V as M,C as xe,a as f}from"./save-4a888371.js";import{B as we,D as j,W as G,X as Ie,F as Ue,E as Be}from"./VOverlay-618ab10c.js";import{m as Fe,i as ze,f as Re,j as De,k as Ae,g as Ke,l as _e,a as he,h as Z}from"./VChip-1f87aeb6.js";const Ne=ie({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,hint:String,persistentHint:Boolean,placeholder:String,showSize:{type:[Boolean,Number],default:!1,validator:s=>typeof s=="boolean"||[1e3,1024].includes(s)},...Fe({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:s=>re(s).every(b=>b!=null&&typeof b=="object")},...ze({clearable:!0})},emits:{"click:control":s=>!0,"update:modelValue":s=>!0},setup(s,b){let{attrs:S,emit:N,slots:i}=b;const{t:r}=de(),u=fe(s,"modelValue"),C=k(()=>typeof s.showSize!="boolean"?s.showSize:void 0),y=k(()=>(u.value??[]).reduce((e,l)=>{let{size:m=0}=l;return e+m},0)),g=k(()=>O(y.value,C.value)),U=k(()=>(u.value??[]).map(e=>{const{name:l="",size:m=0}=e;return s.showSize?`${l} (${O(m,C.value)})`:l})),B=k(()=>{var e;const l=((e=u.value)==null?void 0:e.length)??0;return s.showSize?r(s.counterSizeString,l,g.value):r(s.counterString,l)}),P=v(),x=v(),p=v(!1),c=v(),F=k(()=>s.messages.length?s.messages:s.persistentHint?s.hint:"");function V(){if(c.value!==document.activeElement){var e;(e=c.value)==null||e.focus()}p.value||(p.value=!0)}function w(e){J(s["onClick:prepend"],e),A(e)}function A(e){var l;(l=c.value)==null||l.click(),N("click:control",e)}function a(e){e.stopPropagation(),V(),me(()=>{u.value=[],c!=null&&c.value&&(c.value.value=""),J(s["onClick:clear"],e)})}return ce(()=>{const e=!!(i.counter||s.counter),l=!!(e||i.details),[m,T]=ve(S),[{modelValue:je,...ee}]=Re(s),[le]=De(s);return t(he,E({ref:P,modelValue:u.value,"onUpdate:modelValue":z=>u.value=z,class:"v-file-input","onClick:prepend":w,"onClick:append":s["onClick:append"]},m,ee,{focused:p.value,messages:F.value}),{...i,default:z=>{let{id:K,isDisabled:_,isDirty:W,isReadonly:ae,isValid:te}=z;return t(Ae,E({ref:x,"prepend-icon":s.prependIcon,"onClick:control":A,"onClick:clear":a,"onClick:prependInner":s["onClick:prependInner"],"onClick:appendInner":s["onClick:appendInner"]},le,{id:K.value,active:W.value||p.value,dirty:W.value,focused:p.value,error:te.value===!1}),{...i,default:ne=>{var H;let{props:{class:se,...oe}}=ne;return t(I,null,[t("input",E({ref:c,type:"file",readonly:ae.value,disabled:_.value,multiple:s.multiple,name:s.name,onClick:$=>{$.stopPropagation(),V()},onChange:$=>{if(!$.target)return;const ue=$.target;u.value=[...ue.files??[]]},onFocus:V,onBlur:()=>p.value=!1},oe,T),null),t("div",{class:se},[!!((H=u.value)!=null&&H.length)&&(i.selection?i.selection({fileNames:U.value,totalBytes:y.value,totalBytesReadable:g.value}):s.chips?U.value.map($=>t(Ke,{key:$,size:"small",color:s.color},{default:()=>[$]})):U.value.join(", "))])])}})},details:l?z=>{var K,_;return t(I,null,[(K=i.details)==null?void 0:K.call(i,z),e&&t(I,null,[t("span",null,null),t(_e,{active:!!((_=u.value)!=null&&_.length),value:B.value},i.counter)])])}:void 0})}),we({},P,x,c)}}),Te={class:"d-flex flex-column"},Ee={class:"d-flex flex-column"},Le={class:"d-flex flex-column"},Me={class:"d-flex flex-column"},Je=pe({__name:"LocalGame",props:{config:null},setup(s){const b=s,S=ge(),N=ke(),i=be();i.LoadStorage();const r=new Se,u=new xe(0,r);r.init(b.config),r.game.start();const C=v({canUndo:!1,canRedo:!1}),y=v(r.game.getState()),g=k(()=>y.value.player[0]);r.server.notify.push(a=>{y.value=a}),r.saveStateChanged=()=>{C.value=r.getState()};function U(){N.back()}document.onkeydown=a=>{if(!(a.shiftKey||a.altKey)){if(a.ctrlKey){switch(a.key){case"z":C.value.canUndo&&r.undo();break;case"y":C.value.canRedo&&r.redo();break}return}switch(a.key){case"w":u.autoPost({msg:"$upgrade"});break;case"z":u.autoPost({msg:"$finish"});break;case"c":u.autoPost({msg:u.getPlayer()?.locked?"$unlock":"$lock"});break;case"r":u.autoPost({msg:"$refresh"});break;default:{const e=y.value.player[u.pos];if(!e||e.selected.area==="none")break;for(const l of e[e.selected.area][e.selected.place]?.actions||[])if(a.key===l.acckey){u.post(l.msg);break}}}}};const B=v(!1),P=v(""),x=k(()=>y.value.config.ActivePack.map(a=>Ce[a]).reduce((a,e)=>a.concat(e),[]).map(a=>ye[a]).map((a,e)=>({card:a,find:a.pinyin.indexOf(P.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({card:a})=>a).slice(0,10)),p=v(!1),c=v(""),F=k(()=>Ve.map(a=>$e[a]).map((a,e)=>({unit:a,find:a.pinyin.indexOf(c.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({unit:a})=>a).slice(0,10)),V=v(!1),w=v([]);function A(){i.Upload(w.value[0]),V.value=!1}return(a,e)=>(R(),L(I,null,[t(Pe,{class:"MiddleScale",state:y.value,client:n(u)},{default:o(()=>[h("div",Te,[t(f,{variant:"flat",onClick:e[0]||(e[0]=l=>U())},{default:o(()=>[d(" 返回 ")]),_:1}),t(f,{variant:"flat",onClick:e[1]||(e[1]=l=>B.value=!0),disabled:n(g)?.status!=="normal"},{default:o(()=>[d(" 卡牌 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:n(g)?.selected.area!=="present"||n(g)?.status!=="normal",onClick:e[2]||(e[2]=l=>p.value=!0)},{default:o(()=>[d(" 单位 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:n(g)?.status!=="normal",onClick:e[3]||(e[3]=l=>n(u).autoPost({msg:"$cheat",type:"resource"}))},{default:o(()=>[d(" 资源 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",class:"mt-auto",onClick:e[4]||(e[4]=l=>n(S).toggleFullScreen())},{default:o(()=>[d(D(n(S).isFullScreen?"窗口":"全屏"),1)]),_:1})]),h("div",Ee,[t(f,{variant:"flat",disabled:!C.value.canUndo,onClick:e[5]||(e[5]=l=>n(r).undo())},{default:o(()=>[d(" 撤销 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:!C.value.canRedo,onClick:e[6]||(e[6]=l=>n(r).redo())},{default:o(()=>[d(" 重做 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",onClick:e[7]||(e[7]=l=>n(i).SaveStorage(n(r).save))},{default:o(()=>[d(" 保存 ")]),_:1}),t(f,{variant:"flat",disabled:!n(i).save,onClick:e[8]||(e[8]=l=>n(i).save?n(r).load(n(i).save):void 0)},{default:o(()=>[d(" 读取 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:!n(i).save,onClick:e[9]||(e[9]=l=>n(i).CleanStorage())},{default:o(()=>[d(" 清除 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",disabled:!n(i).save,onClick:e[10]||(e[10]=l=>n(i).Download())},{default:o(()=>[d(" 导出 ")]),_:1},8,["disabled"]),t(f,{variant:"flat",onClick:e[11]||(e[11]=l=>V.value=!0)},{default:o(()=>[d(" 导入 ")]),_:1})])]),_:1},8,["state","client"]),t(M,{modelValue:B.value,"onUpdate:modelValue":e[14]||(e[14]=l=>B.value=l)},{default:o(()=>[t(j,null,{default:o(()=>[t(G,null,{default:o(()=>[t(Z,{"hide-details":"",density:n(S).isMobile?"compact":"default",modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=l=>P.value=l),onKeyup:e[13]||(e[13]=q(l=>n(x).length>0&&n(u).autoPost({msg:"$cheat",type:"card",cardt:n(x)[0].name}),["enter"]))},null,8,["density","modelValue"]),h("div",Le,[(R(!0),L(I,null,Q(n(x),(l,m)=>(R(),X(f,{variant:"flat",class:Y({enterSelect:m===0}),key:`GCChoice-${m}`,onClick:T=>n(u).autoPost({msg:"$cheat",type:"card",cardt:l.name})},{default:o(()=>[d(D(l.pinyin)+" "+D(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:p.value,"onUpdate:modelValue":e[17]||(e[17]=l=>p.value=l)},{default:o(()=>[t(j,null,{default:o(()=>[t(G,null,{default:o(()=>[t(Z,{"hide-details":"",density:n(S).isMobile?"compact":"default",modelValue:c.value,"onUpdate:modelValue":e[15]||(e[15]=l=>c.value=l),onKeyup:e[16]||(e[16]=q(l=>n(F).length>0&&n(u).autoPost({msg:"$cheat",type:"unit",units:[n(F)[0].name],place:n(g)?.selected.place||0}),["enter"]))},null,8,["density","modelValue"]),h("div",Me,[(R(!0),L(I,null,Q(n(F),(l,m)=>(R(),X(f,{variant:"flat",class:Y({enterSelect:m===0}),key:`GUChoice-${m}`,onClick:T=>n(u).autoPost({msg:"$cheat",type:"unit",units:[l.name],place:n(g)?.selected.place||0})},{default:o(()=>[d(D(l.pinyin)+" "+D(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:V.value,"onUpdate:modelValue":e[20]||(e[20]=l=>V.value=l)},{default:o(()=>[t(j,null,{default:o(()=>[t(Ie,null,{default:o(()=>[d(" 导入 ")]),_:1}),t(G,null,{default:o(()=>[t(Ne,{modelValue:w.value,"onUpdate:modelValue":e[18]||(e[18]=l=>w.value=l),accept:".SCTReplay"},null,8,["modelValue"])]),_:1}),t(Ue,null,{default:o(()=>[t(Be,{color:"primary",disabled:w.value.length!==1,onClick:e[19]||(e[19]=l=>A())},{default:o(()=>[d(" 确定 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{Je as default};
