import{b as de,v as re,a6 as ce,u as ve,c as g,b8 as X,r as m,h as fe,k as me,i as a,n as H,a7 as z,aG as Y,y as pe,a9 as ke,aa as ye,af as K,ae as o,ad as s,al as T,ab as S,b9 as O,ba as Z,bb as G,ah as ee,ac as W,a8 as c,bc as j,bd as le,be as ge,ak as Ce,aj as be,ap as Ve,bf as $e,bg as Se,bh as xe,bi as Pe}from"./index-c7ebcf82.js";import{u as _e,W as we,_ as Ie,V as q,C as Ue,a as v}from"./save-2ea4c38f.js";import{m as ze,i as Be,f as Fe,j as Re,k as he,g as De,l as Ae,a as Ke,h as ae}from"./VChip-bda59013.js";import{c as Ne,d as Le}from"./VOverlay-26fedf1f.js";const Me=de({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,hint:String,persistentHint:Boolean,placeholder:String,showSize:{type:[Boolean,Number],default:!1,validator:n=>typeof n=="boolean"||[1e3,1024].includes(n)},...ze({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:n=>re(n).every(_=>_!=null&&typeof _=="object")},...Be({clearable:!0})},emits:{"click:control":n=>!0,"update:modelValue":n=>!0},setup(n,_){let{attrs:B,emit:E,slots:i}=_;const{t:r}=ce(),u=ve(n,"modelValue"),C=g(()=>typeof n.showSize!="boolean"?n.showSize:void 0),b=g(()=>(u.value??[]).reduce((l,e)=>{let{size:t=0}=e;return l+t},0)),y=g(()=>X(b.value,C.value)),F=g(()=>(u.value??[]).map(l=>{const{name:e="",size:t=0}=l;return n.showSize?`${e} (${X(t,C.value)})`:e})),R=g(()=>{var l;const e=((l=u.value)==null?void 0:l.length)??0;return n.showSize?r(n.counterSizeString,e,y.value):r(n.counterString,e)}),w=m(),I=m(),k=m(!1),p=m(),h=g(()=>n.messages.length?n.messages:n.persistentHint?n.hint:"");function V(){if(p.value!==document.activeElement){var l;(l=p.value)==null||l.focus()}k.value||(k.value=!0)}function U(l){Y(n["onClick:prepend"],l),N(l)}function N(l){var e;(e=p.value)==null||e.click(),E("click:control",l)}function D(l){l.stopPropagation(),V(),pe(()=>{u.value=[],p!=null&&p.value&&(p.value.value=""),Y(n["onClick:clear"],l)})}return fe(()=>{const l=!!(i.counter||n.counter),e=!!(l||i.details),[t,d]=me(B),[{modelValue:$,...x}]=Fe(n),[f]=Re(n);return a(Ke,H({ref:w,modelValue:u.value,"onUpdate:modelValue":A=>u.value=A,class:"v-file-input","onClick:prepend":U,"onClick:append":n["onClick:append"]},t,x,{focused:k.value,messages:h.value}),{...i,default:A=>{let{id:L,isDisabled:M,isDirty:J,isReadonly:te,isValid:ne}=A;return a(he,H({ref:I,"prepend-icon":n.prependIcon,"onClick:control":N,"onClick:clear":D,"onClick:prependInner":n["onClick:prependInner"],"onClick:appendInner":n["onClick:appendInner"]},f,{id:L.value,active:J.value||k.value,dirty:J.value,focused:k.value,error:ne.value===!1}),{...i,default:oe=>{var Q;let{props:{class:se,...ue}}=oe;return a(z,null,[a("input",H({ref:p,type:"file",readonly:te.value,disabled:M.value,multiple:n.multiple,name:n.name,onClick:P=>{P.stopPropagation(),V()},onChange:P=>{if(!P.target)return;const ie=P.target;u.value=[...ie.files??[]]},onFocus:V,onBlur:()=>k.value=!1},ue,d),null),a("div",{class:se},[!!((Q=u.value)!=null&&Q.length)&&(i.selection?i.selection({fileNames:F.value,totalBytes:b.value,totalBytesReadable:y.value}):n.chips?F.value.map(P=>a(De,{key:P,size:"small",color:n.color},{default:()=>[P]})):F.value.join(", "))])])}})},details:e?A=>{var L,M;return a(z,null,[(L=i.details)==null?void 0:L.call(i,A),l&&a(z,null,[a("span",null,null),a(Ae,{active:!!((M=u.value)!=null&&M.length),value:R.value},i.counter)])])}:void 0})}),Ne({},w,I,p)}}),Te={class:"d-flex flex-column"},Ge={class:"d-flex flex-column"},je={key:0,class:"Label mx-auto"},Ee={key:2,class:"d-flex"},He={class:"d-flex flex-column"},Oe={class:"d-flex flex-column"},Xe=ke({__name:"LocalGame",props:{config:null},setup(n){const _=n,B=ye(),E=Ve(),i=_e();i.LoadStorage();const r=new we,u=new Ue(0,r);r.init(_.config),r.game.start();const C=m({canUndo:!1,canRedo:!1}),b=m(r.game.getState()),y=g(()=>b.value.player[0]);r.server.notify.push(l=>{b.value=l}),r.saveStateChanged=()=>{C.value=r.getState()};function F(){E.back()}document.onkeydown=l=>{var e,t;if(!(l.shiftKey||l.altKey)){if(l.ctrlKey){switch(l.key){case"z":C.value.canUndo&&r.undo();break;case"y":C.value.canRedo&&r.redo();break}return}switch(l.key){case"w":u.autoPost({msg:"$upgrade"});break;case"z":u.autoPost({msg:"$finish"});break;case"c":u.autoPost({msg:(e=u.getPlayer())!=null&&e.locked?"$unlock":"$lock"});break;case"r":u.autoPost({msg:"$refresh"});break;default:{const d=b.value.player[u.pos];if(!d||d.selected.area==="none")break;for(const $ of((t=d[d.selected.area][d.selected.place])==null?void 0:t.actions)||[])if(l.key===$.acckey){u.post($.msg);break}}}}};const R=m(!1),w=m(""),I=g(()=>b.value.config.ActivePack.map(l=>$e[l]).reduce((l,e)=>l.concat(e),[]).map(l=>Se[l]).map((l,e)=>({card:l,find:l.pinyin.indexOf(w.value),index:e})).filter(({find:l})=>l!==-1).sort((l,e)=>l.find!==e.find?l.find-e.find:l.index-e.index).map(({card:l})=>l).slice(0,10)),k=m(!1),p=m(""),h=g(()=>xe.map(l=>Pe[l]).map((l,e)=>({unit:l,find:l.pinyin.indexOf(p.value),index:e})).filter(({find:l})=>l!==-1).sort((l,e)=>l.find!==e.find?l.find-e.find:l.index-e.index).map(({unit:l})=>l).slice(0,10)),V=m(!1),U=m([]);function N(){i.Upload(U.value[0]),V.value=!1}const D=m(!0);return(l,e)=>(S(),K(z,null,[a(Ie,{state:b.value,client:o(u)},null,8,["state","client"]),a(q,{modelValue:R.value,"onUpdate:modelValue":e[2]||(e[2]=t=>R.value=t)},{default:s(()=>[a(T,null,{default:s(()=>[a(O,null,{default:s(()=>[a(ae,{"hide-details":"",density:o(B).isMobile?"compact":"default",modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),onKeyup:e[1]||(e[1]=Z(t=>o(I).length>0&&o(u).autoPost({msg:"$cheat",type:"card",cardt:o(I)[0].name}),["enter"]))},null,8,["density","modelValue"]),G("div",Te,[(S(!0),K(z,null,ee(o(I),(t,d)=>(S(),W(v,{variant:"flat",class:le({enterSelect:d===0}),key:`GCChoice-${d}`,onClick:$=>o(u).autoPost({msg:"$cheat",type:"card",cardt:t.name})},{default:s(()=>[c(j(t.pinyin)+" "+j(t.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(q,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=t=>k.value=t)},{default:s(()=>[a(T,null,{default:s(()=>[a(O,null,{default:s(()=>[a(ae,{"hide-details":"",density:o(B).isMobile?"compact":"default",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=t=>p.value=t),onKeyup:e[4]||(e[4]=Z(t=>{var d;return o(h).length>0&&o(u).autoPost({msg:"$cheat",type:"unit",units:[o(h)[0].name],place:((d=o(y))==null?void 0:d.selected.place)||0})},["enter"]))},null,8,["density","modelValue"]),G("div",Ge,[(S(!0),K(z,null,ee(o(h),(t,d)=>(S(),W(v,{variant:"flat",class:le({enterSelect:d===0}),key:`GUChoice-${d}`,onClick:$=>{var x;return o(u).autoPost({msg:"$cheat",type:"unit",units:[t.name],place:((x=o(y))==null?void 0:x.selected.place)||0})}},{default:s(()=>[c(j(t.pinyin)+" "+j(t.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(q,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=t=>V.value=t)},{default:s(()=>[a(T,null,{default:s(()=>[a(ge,null,{default:s(()=>[c(" 导入 ")]),_:1}),a(O,null,{default:s(()=>[a(Me,{modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=t=>U.value=t),accept:".SCTReplay"},null,8,["modelValue"])]),_:1}),a(Ce,null,{default:s(()=>[a(Le,{color:"primary",disabled:U.value.length!==1,onClick:e[7]||(e[7]=t=>N())},{default:s(()=>[c(" 确定 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(T,{class:"ControlPanel d-flex flex-column"},{default:s(()=>{var t,d,$,x;return[o(B).isMobile?(S(),W(v,{key:1,onClick:e[9]||(e[9]=f=>D.value=!D.value)},{default:s(()=>[c(" 菜单 ")]),_:1})):(S(),K("span",je,"菜单")),D.value?(S(),K("div",Ee,[G("div",He,[a(v,{variant:"elevated",onClick:e[10]||(e[10]=f=>F())},{default:s(()=>[c(" 返回 ")]),_:1}),a(v,{variant:"elevated",onClick:e[11]||(e[11]=f=>R.value=!0),disabled:((t=o(y))==null?void 0:t.status)!=="normal"},{default:s(()=>[c(" 卡牌 ")]),_:1},8,["disabled"]),a(v,{variant:"elevated",disabled:((d=o(y))==null?void 0:d.selected.area)!=="present"||(($=o(y))==null?void 0:$.status)!=="normal",onClick:e[12]||(e[12]=f=>k.value=!0)},{default:s(()=>[c(" 单位 ")]),_:1},8,["disabled"]),a(v,{variant:"elevated",disabled:((x=o(y))==null?void 0:x.status)!=="normal",onClick:e[13]||(e[13]=f=>o(u).autoPost({msg:"$cheat",type:"resource"}))},{default:s(()=>[c(" 资源 ")]),_:1},8,["disabled"])]),G("div",Oe,[a(v,{variant:"elevated",disabled:!C.value.canUndo,onClick:e[14]||(e[14]=f=>o(r).undo())},{default:s(()=>[c(" 撤销 ")]),_:1},8,["disabled"]),a(v,{variant:"elevated",disabled:!C.value.canRedo,onClick:e[15]||(e[15]=f=>o(r).redo())},{default:s(()=>[c(" 重做 ")]),_:1},8,["disabled"]),a(v,{variant:"elevated",onClick:e[16]||(e[16]=f=>o(i).SaveStorage(o(r).save))},{default:s(()=>[c(" 保存 ")]),_:1}),a(v,{variant:"elevated",disabled:!o(i).save,onClick:e[17]||(e[17]=f=>o(i).save?o(r).load(o(i).save):void 0)},{default:s(()=>[c(" 读取 ")]),_:1},8,["disabled"]),a(v,{variant:"elevated",disabled:!o(i).save,onClick:e[18]||(e[18]=f=>o(i).CleanStorage())},{default:s(()=>[c(" 清除 ")]),_:1},8,["disabled"]),a(v,{variant:"elevated",disabled:!o(i).save,onClick:e[19]||(e[19]=f=>o(i).Download())},{default:s(()=>[c(" 导出 ")]),_:1},8,["disabled"]),a(v,{variant:"elevated",onClick:e[20]||(e[20]=f=>V.value=!0)},{default:s(()=>[c(" 导入 ")]),_:1})])])):be("",!0)]}),_:1})],64))}});export{Xe as default};
