import{a as re,q as de,J as fe,u as ce,c as y,aC as q,r as p,f as ve,j as me,h as t,l as M,K as F,aB as Q,s as pe,M as ge,N as ke,T as j,P as o,R as n,Q as K,U as E,L as f,aD as _,aE as X,W as Y,O as Z,aF as ee,a0 as Ce,aG as ye,aH as Ve,aI as $e,aJ as be}from"./index-4c6a98bf.js";import{u as Se,W as Pe,_ as xe,V as G,C as we,a as c}from"./save-d7c53912.js";import{B as Ie,D as W,W as H,X as Ue,F as Be,E as Fe}from"./VOverlay-a6e35c25.js";import{m as ze,i as Re,f as De,j as Ae,k as Ke,g as _e,l as he,a as Ne,h as le}from"./VChip-3cfcdb10.js";const Te=re({name:"VFileInput",inheritAttrs:!1,props:{chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,hint:String,persistentHint:Boolean,placeholder:String,showSize:{type:[Boolean,Number],default:!1,validator:s=>typeof s=="boolean"||[1e3,1024].includes(s)},...ze({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:s=>de(s).every(P=>P!=null&&typeof P=="object")},...Re({clearable:!0})},emits:{"click:control":s=>!0,"update:modelValue":s=>!0},setup(s,P){let{attrs:x,emit:L,slots:r}=P;const{t:d}=fe(),u=ce(s,"modelValue"),V=y(()=>typeof s.showSize!="boolean"?s.showSize:void 0),$=y(()=>(u.value??[]).reduce((e,a)=>{let{size:i=0}=a;return e+i},0)),k=y(()=>q($.value,V.value)),z=y(()=>(u.value??[]).map(e=>{const{name:a="",size:i=0}=e;return s.showSize?`${a} (${q(i,V.value)})`:a})),R=y(()=>{var e;const a=((e=u.value)==null?void 0:e.length)??0;return s.showSize?d(s.counterSizeString,a,k.value):d(s.counterString,a)}),w=p(),I=p(),g=p(!1),m=p(),D=y(()=>s.messages.length?s.messages:s.persistentHint?s.hint:"");function b(){if(m.value!==document.activeElement){var e;(e=m.value)==null||e.focus()}g.value||(g.value=!0)}function U(e){Q(s["onClick:prepend"],e),h(e)}function h(e){var a;(a=m.value)==null||a.click(),L("click:control",e)}function l(e){e.stopPropagation(),b(),pe(()=>{u.value=[],m!=null&&m.value&&(m.value.value=""),Q(s["onClick:clear"],e)})}return ve(()=>{const e=!!(r.counter||s.counter),a=!!(e||r.details),[i,C]=me(x),[{modelValue:B,...v}]=De(s),[ae]=Ae(s);return t(Ne,M({ref:w,modelValue:u.value,"onUpdate:modelValue":A=>u.value=A,class:"v-file-input","onClick:prepend":U,"onClick:append":s["onClick:append"]},i,v,{focused:g.value,messages:D.value}),{...r,default:A=>{let{id:N,isDisabled:T,isDirty:O,isReadonly:te,isValid:ne}=A;return t(Ke,M({ref:I,"prepend-icon":s.prependIcon,"onClick:control":h,"onClick:clear":l,"onClick:prependInner":s["onClick:prependInner"],"onClick:appendInner":s["onClick:appendInner"]},ae,{id:N.value,active:O.value||g.value,dirty:O.value,focused:g.value,error:ne.value===!1}),{...r,default:se=>{var J;let{props:{class:oe,...ue}}=se;return t(F,null,[t("input",M({ref:m,type:"file",readonly:te.value,disabled:T.value,multiple:s.multiple,name:s.name,onClick:S=>{S.stopPropagation(),b()},onChange:S=>{if(!S.target)return;const ie=S.target;u.value=[...ie.files??[]]},onFocus:b,onBlur:()=>g.value=!1},ue,C),null),t("div",{class:oe},[!!((J=u.value)!=null&&J.length)&&(r.selection?r.selection({fileNames:z.value,totalBytes:$.value,totalBytesReadable:k.value}):s.chips?z.value.map(S=>t(_e,{key:S,size:"small",color:s.color},{default:()=>[S]})):z.value.join(", "))])])}})},details:a?A=>{var N,T;return t(F,null,[(N=r.details)==null?void 0:N.call(r,A),e&&t(F,null,[t("span",null,null),t(he,{active:!!((T=u.value)!=null&&T.length),value:R.value},r.counter)])])}:void 0})}),Ie({},w,I,m)}}),Ee={class:"d-flex flex-column"},Le={class:"d-flex flex-column"},Me={class:"d-flex flex-column"},je={class:"d-flex flex-column"},Je=ge({__name:"LocalGame",props:{config:null},setup(s){const P=s,x=ke(),L=Ce(),r=Se();r.LoadStorage();const d=new Pe,u=new we(0,d);d.init(P.config),d.game.start();const V=p({canUndo:!1,canRedo:!1}),$=p(d.game.getState()),k=y(()=>$.value.player[0]);d.server.notify.push(l=>{$.value=l}),d.saveStateChanged=()=>{V.value=d.getState()};function z(){L.back()}document.onkeydown=l=>{var e,a;if(!(l.shiftKey||l.altKey)){if(l.ctrlKey){switch(l.key){case"z":V.value.canUndo&&d.undo();break;case"y":V.value.canRedo&&d.redo();break}return}switch(l.key){case"w":u.autoPost({msg:"$upgrade"});break;case"z":u.autoPost({msg:"$finish"});break;case"c":u.autoPost({msg:(e=u.getPlayer())!=null&&e.locked?"$unlock":"$lock"});break;case"r":u.autoPost({msg:"$refresh"});break;default:{const i=$.value.player[u.pos];if(!i||i.selected.area==="none")break;for(const C of((a=i[i.selected.area][i.selected.place])==null?void 0:a.actions)||[])if(l.key===C.acckey){u.post(C.msg);break}}}}};const R=p(!1),w=p(""),I=y(()=>$.value.config.ActivePack.map(l=>ye[l]).reduce((l,e)=>l.concat(e),[]).map(l=>Ve[l]).map((l,e)=>({card:l,find:l.pinyin.indexOf(w.value),index:e})).filter(({find:l})=>l!==-1).sort((l,e)=>l.find!==e.find?l.find-e.find:l.index-e.index).map(({card:l})=>l).slice(0,10)),g=p(!1),m=p(""),D=y(()=>$e.map(l=>be[l]).map((l,e)=>({unit:l,find:l.pinyin.indexOf(m.value),index:e})).filter(({find:l})=>l!==-1).sort((l,e)=>l.find!==e.find?l.find-e.find:l.index-e.index).map(({unit:l})=>l).slice(0,10)),b=p(!1),U=p([]);function h(){r.Upload(U.value[0]),b.value=!1}return(l,e)=>(K(),j(F,null,[t(xe,{class:"MiddleScale",state:$.value,client:n(u)},{default:o(()=>{var a,i,C,B;return[E("div",Ee,[t(c,{variant:"flat",onClick:e[0]||(e[0]=v=>z())},{default:o(()=>[f(" 返回 ")]),_:1}),t(c,{variant:"flat",onClick:e[1]||(e[1]=v=>R.value=!0),disabled:((a=n(k))==null?void 0:a.status)!=="normal"},{default:o(()=>[f(" 卡牌 ")]),_:1},8,["disabled"]),t(c,{variant:"flat",disabled:((i=n(k))==null?void 0:i.selected.area)!=="present"||((C=n(k))==null?void 0:C.status)!=="normal",onClick:e[2]||(e[2]=v=>g.value=!0)},{default:o(()=>[f(" 单位 ")]),_:1},8,["disabled"]),t(c,{variant:"flat",disabled:((B=n(k))==null?void 0:B.status)!=="normal",onClick:e[3]||(e[3]=v=>n(u).autoPost({msg:"$cheat",type:"resource"}))},{default:o(()=>[f(" 资源 ")]),_:1},8,["disabled"]),t(c,{variant:"flat",class:"mt-auto",onClick:e[4]||(e[4]=v=>n(x).toggleFullScreen())},{default:o(()=>[f(_(n(x).isFullScreen?"窗口":"全屏"),1)]),_:1})]),E("div",Le,[t(c,{variant:"flat",disabled:!V.value.canUndo,onClick:e[5]||(e[5]=v=>n(d).undo())},{default:o(()=>[f(" 撤销 ")]),_:1},8,["disabled"]),t(c,{variant:"flat",disabled:!V.value.canRedo,onClick:e[6]||(e[6]=v=>n(d).redo())},{default:o(()=>[f(" 重做 ")]),_:1},8,["disabled"]),t(c,{variant:"flat",onClick:e[7]||(e[7]=v=>n(r).SaveStorage(n(d).save))},{default:o(()=>[f(" 保存 ")]),_:1}),t(c,{variant:"flat",disabled:!n(r).save,onClick:e[8]||(e[8]=v=>n(r).save?n(d).load(n(r).save):void 0)},{default:o(()=>[f(" 读取 ")]),_:1},8,["disabled"]),t(c,{variant:"flat",disabled:!n(r).save,onClick:e[9]||(e[9]=v=>n(r).CleanStorage())},{default:o(()=>[f(" 清除 ")]),_:1},8,["disabled"]),t(c,{variant:"flat",disabled:!n(r).save,onClick:e[10]||(e[10]=v=>n(r).Download())},{default:o(()=>[f(" 导出 ")]),_:1},8,["disabled"]),t(c,{variant:"flat",onClick:e[11]||(e[11]=v=>b.value=!0)},{default:o(()=>[f(" 导入 ")]),_:1})])]}),_:1},8,["state","client"]),t(G,{modelValue:R.value,"onUpdate:modelValue":e[14]||(e[14]=a=>R.value=a)},{default:o(()=>[t(W,null,{default:o(()=>[t(H,null,{default:o(()=>[t(le,{"hide-details":"",density:n(x).isMobile?"compact":"default",modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=a=>w.value=a),onKeyup:e[13]||(e[13]=X(a=>n(I).length>0&&n(u).autoPost({msg:"$cheat",type:"card",cardt:n(I)[0].name}),["enter"]))},null,8,["density","modelValue"]),E("div",Me,[(K(!0),j(F,null,Y(n(I),(a,i)=>(K(),Z(c,{variant:"flat",class:ee({enterSelect:i===0}),key:`GCChoice-${i}`,onClick:C=>n(u).autoPost({msg:"$cheat",type:"card",cardt:a.name})},{default:o(()=>[f(_(a.pinyin)+" "+_(a.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(G,{modelValue:g.value,"onUpdate:modelValue":e[17]||(e[17]=a=>g.value=a)},{default:o(()=>[t(W,null,{default:o(()=>[t(H,null,{default:o(()=>[t(le,{"hide-details":"",density:n(x).isMobile?"compact":"default",modelValue:m.value,"onUpdate:modelValue":e[15]||(e[15]=a=>m.value=a),onKeyup:e[16]||(e[16]=X(a=>{var i;return n(D).length>0&&n(u).autoPost({msg:"$cheat",type:"unit",units:[n(D)[0].name],place:((i=n(k))==null?void 0:i.selected.place)||0})},["enter"]))},null,8,["density","modelValue"]),E("div",je,[(K(!0),j(F,null,Y(n(D),(a,i)=>(K(),Z(c,{variant:"flat",class:ee({enterSelect:i===0}),key:`GUChoice-${i}`,onClick:C=>{var B;return n(u).autoPost({msg:"$cheat",type:"unit",units:[a.name],place:((B=n(k))==null?void 0:B.selected.place)||0})}},{default:o(()=>[f(_(a.pinyin)+" "+_(a.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(G,{modelValue:b.value,"onUpdate:modelValue":e[20]||(e[20]=a=>b.value=a)},{default:o(()=>[t(W,null,{default:o(()=>[t(Ue,null,{default:o(()=>[f(" 导入 ")]),_:1}),t(H,null,{default:o(()=>[t(Te,{modelValue:U.value,"onUpdate:modelValue":e[18]||(e[18]=a=>U.value=a),accept:".SCTReplay"},null,8,["modelValue"])]),_:1}),t(Be,null,{default:o(()=>[t(Fe,{color:"primary",disabled:U.value.length!==1,onClick:e[19]||(e[19]=a=>h())},{default:o(()=>[f(" 确定 ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{Je as default};
