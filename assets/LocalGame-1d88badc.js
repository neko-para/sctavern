import{d as h,r as c,h as U,c as P,n as s,L as t,K as o,W as w,O as K,o as g,aN as L,aO as N,aP as v,P as R,J as B,N as r,aQ as y,aR as G,u as E,aS as J,aT as Q,aU as j,aV as q}from"./index-16e64f07.js";import{u as H,W as I,_ as M,V as O,C as X,a as u}from"./save-e71ffea9.js";import{b as T}from"./VTextField-49958cc9.js";import"./forwardRefs-09790d07.js";const Y={class:"d-flex flex-column"},Z={class:"d-flex flex-column"},ee=v("span",{class:"Label mx-auto"},"菜单",-1),ae={class:"d-flex"},te={class:"d-flex flex-column"},le={class:"d-flex flex-column"},ie=h({__name:"LocalGame",props:{config:null},setup(z){const W=z,A=E(),f=H();f.LoadStorage();const d=new I,i=new X(0,d);d.init(W.config),d.game.start();const m=c({canUndo:!1,canRedo:!1}),p=c(d.game.getState()),C=U(()=>p.value.player[0]);d.server.notify.push(a=>{p.value=a}),d.saveStateChanged=()=>{m.value=d.getState()};function F(){A.back()}document.onkeydown=a=>{var e,l;if(!(a.shiftKey||a.altKey)){if(a.ctrlKey){switch(a.key){case"z":m.value.canUndo&&d.undo();break;case"y":m.value.canRedo&&d.redo();break}return}switch(a.key){case"w":i.autoPost({msg:"$upgrade"});break;case"z":i.autoPost({msg:"$finish"});break;case"c":i.autoPost({msg:(e=i.getPlayer())!=null&&e.locked?"$unlock":"$lock"});break;case"r":i.autoPost({msg:"$refresh"});break;default:{const n=p.value.player[i.pos];if(!n||n.selected.area==="none")break;for(const k of((l=n[n.selected.area][n.selected.place])==null?void 0:l.actions)||[])if(a.key===k.acckey){i.post(k.msg);break}}}}};const x=c(!1),$=c(""),V=U(()=>p.value.config.ActivePack.map(a=>J[a]).reduce((a,e)=>a.concat(e),[]).map(a=>Q[a]).map((a,e)=>({card:a,find:a.pinyin.indexOf($.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({card:a})=>a).slice(0,10)),_=c(!1),b=c(""),S=U(()=>j.map(a=>q[a]).map((a,e)=>({unit:a,find:a.pinyin.indexOf(b.value),index:e})).filter(({find:a})=>a!==-1).sort((a,e)=>a.find!==e.find?a.find-e.find:a.index-e.index).map(({unit:a})=>a).slice(0,10));return(a,e)=>(g(),P(K,null,[s(M,{state:p.value,client:t(i)},null,8,["state","client"]),s(O,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l)},{default:o(()=>[s(w,null,{default:o(()=>[s(L,null,{default:o(()=>[s(T,{"hide-details":"",modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=l=>$.value=l),onKeyup:e[1]||(e[1]=N(l=>t(V).length>0&&t(i).autoPost({msg:"$cheat",type:"card",cardt:t(V)[0].name}),["enter"]))},null,8,["modelValue"]),v("div",Y,[(g(!0),P(K,null,R(t(V),(l,n)=>(g(),B(u,{variant:"flat",class:G({enterSelect:n===0}),key:`GCChoice-${n}`,onClick:k=>t(i).autoPost({msg:"$cheat",type:"card",cardt:l.name})},{default:o(()=>[r(y(l.pinyin)+" "+y(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(O,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value=l)},{default:o(()=>[s(w,null,{default:o(()=>[s(L,null,{default:o(()=>[s(T,{"hide-details":"",modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),onKeyup:e[4]||(e[4]=N(l=>{var n;return t(S).length>0&&t(i).autoPost({msg:"$cheat",type:"unit",units:[t(S)[0].name],place:((n=t(C))==null?void 0:n.selected.place)||0})},["enter"]))},null,8,["modelValue"]),v("div",Z,[(g(!0),P(K,null,R(t(S),(l,n)=>(g(),B(u,{variant:"flat",class:G({enterSelect:n===0}),key:`GUChoice-${n}`,onClick:k=>{var D;return t(i).autoPost({msg:"$cheat",type:"unit",units:[l.name],place:((D=t(C))==null?void 0:D.selected.place)||0})}},{default:o(()=>[r(y(l.pinyin)+" "+y(l.name),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(w,{class:"Debug d-flex flex-column"},{default:o(()=>{var l;return[ee,v("div",ae,[v("div",te,[s(u,{variant:"elevated",onClick:e[6]||(e[6]=n=>F())},{default:o(()=>[r(" 返回 ")]),_:1}),s(u,{variant:"elevated",onClick:e[7]||(e[7]=n=>x.value=!0)},{default:o(()=>[r(" 卡牌 ")]),_:1}),s(u,{variant:"elevated",disabled:((l=t(C))==null?void 0:l.selected.area)!=="present",onClick:e[8]||(e[8]=n=>_.value=!0)},{default:o(()=>[r(" 单位 ")]),_:1},8,["disabled"])]),v("div",le,[s(u,{variant:"elevated",disabled:!m.value.canUndo,onClick:e[9]||(e[9]=n=>t(d).undo())},{default:o(()=>[r(" 撤销 ")]),_:1},8,["disabled"]),s(u,{variant:"elevated",disabled:!m.value.canRedo,onClick:e[10]||(e[10]=n=>t(d).redo())},{default:o(()=>[r(" 重做 ")]),_:1},8,["disabled"]),s(u,{variant:"elevated",onClick:e[11]||(e[11]=n=>t(f).SaveStorage(t(d).save))},{default:o(()=>[r(" 保存 ")]),_:1}),s(u,{variant:"elevated",disabled:!t(f).save,onClick:e[12]||(e[12]=n=>t(f).save?t(d).load(t(f).save):void 0)},{default:o(()=>[r(" 读取 ")]),_:1},8,["disabled"]),s(u,{variant:"elevated",disabled:!t(f).save,onClick:e[13]||(e[13]=n=>t(f).CleanStorage())},{default:o(()=>[r(" 清除 ")]),_:1},8,["disabled"])])])]}),_:1})],64))}});export{ie as default};
