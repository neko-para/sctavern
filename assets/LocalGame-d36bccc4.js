import{u as x,W as C,_ as $,C as S,a as i}from"./save-1f3eb2c8.js";import{d as w,r as p,c as P,j as l,s as t,ab as r,ah as K,a5 as L,o as R,aK as v,ad as c,u as U}from"./index-bc01c58f.js";import"./forwardRefs-29a2fcd9.js";const V=v("span",{class:"Label mx-auto"},"菜单",-1),B={class:"d-flex"},N={class:"d-flex flex-column"},h={class:"d-flex flex-column"},j=w({__name:"LocalGame",props:{config:null},setup(g){const _=g,b=U(),d=x();d.LoadStorage();const a=new C,o=new S(0,a);a.init(_.config),a.game.start();const u=p({canUndo:!1,canRedo:!1}),m=p(a.game.getState());a.server.notify.push(s=>{m.value=s}),a.saveStateChanged=()=>{u.value=a.getState()};function y(){b.back()}return document.onkeydown=s=>{var e,n;if(!(s.shiftKey||s.altKey)){if(s.ctrlKey){switch(s.key){case"z":u.value.canUndo&&a.undo();break;case"y":u.value.canRedo&&a.redo();break}return}switch(s.key){case"w":o.autoPost({msg:"$upgrade"});break;case"z":o.autoPost({msg:"$finish"});break;case"c":o.autoPost({msg:(e=o.getPlayer())!=null&&e.locked?"$unlock":"$lock"});break;case"r":o.autoPost({msg:"$refresh"});break;default:{const f=m.value.player[o.pos];if(!f||f.selected.area==="none")break;for(const k of((n=f[f.selected.area][f.selected.place])==null?void 0:n.actions)||[])if(s.key===k.acckey){o.post(k.msg);break}}}}},(s,e)=>(R(),P(L,null,[l($,{state:m.value,client:t(o)},null,8,["state","client"]),l(K,{class:"Debug d-flex flex-column"},{default:r(()=>[V,v("div",B,[v("div",N,[l(i,{variant:"elevated",onClick:e[0]||(e[0]=n=>y())},{default:r(()=>[c(" 返回 ")]),_:1})]),v("div",h,[l(i,{variant:"elevated",disabled:!u.value.canUndo,onClick:e[1]||(e[1]=n=>t(a).undo())},{default:r(()=>[c(" 撤销 ")]),_:1},8,["disabled"]),l(i,{variant:"elevated",disabled:!u.value.canRedo,onClick:e[2]||(e[2]=n=>t(a).redo())},{default:r(()=>[c(" 重做 ")]),_:1},8,["disabled"]),l(i,{variant:"elevated",onClick:e[3]||(e[3]=n=>t(d).SaveStorage(t(a).save))},{default:r(()=>[c(" 保存 ")]),_:1}),l(i,{variant:"elevated",disabled:!t(d).save,onClick:e[4]||(e[4]=n=>t(d).save?t(a).load(t(d).save):void 0)},{default:r(()=>[c(" 读取 ")]),_:1},8,["disabled"]),l(i,{variant:"elevated",disabled:!t(d).save,onClick:e[5]||(e[5]=n=>t(d).CleanStorage())},{default:r(()=>[c(" 清除 ")]),_:1},8,["disabled"])])])]),_:1})],64))}});export{j as default};
